<style>
  /* Role colors */
  .role-judge { color: #1f77b4; }
  .role-jury { color: #ff7f0e; }
  .role-plaintiff { color: #2ca02c; }
  .role-plaintiff-attorney { color: #d62728; }
  .role-defendant { color: #9467bd; }
  .role-defendant-attorney { color: #8c564b; }
  .role-witness { color: #e377c2; }

  /* Chat messages styling */
  ul.court-messages { list-style: none; padding-left: 0; }
  ul.court-messages li { display: flex; align-items: flex-start; margin-bottom: 1em; }
  ul.court-messages img { width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; object-fit: cover; }
  ul.court-messages strong { font-weight: bold; margin-right: 5px; }
  .role-label { font-weight: bold; margin-left: 5px; }

  /* Modal for media */
  .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8); justify-content: center; align-items: center; }
  .modal-content { background-color: #fefefe; padding: 20px; border: 1px solid #888; max-width: 90%; max-height: 90%; display: flex; flex-direction: column; position: relative; }
  .close-button { color: #aaa; position: absolute; top: 10px; right: 20px; font-size: 28px; font-weight: bold; cursor: pointer; }
  .close-button:hover, .close-button:focus { color: black; text-decoration: none; }
  .media-container { max-width: 100%; max-height: 100%; display: flex; justify-content: center; align-items: center; }
  .media-container img, .media-container video { max-width: 100%; max-height: 100%; transition: transform 0.2s; }
  .zoom-controls { display: flex; justify-content: center; margin-top: 10px; gap: 10px; }
  .zoom-controls button { background-color: #444; color: white; border: none; padding: 8px 12px; cursor: pointer; border-radius: 5px; }
</style>

<!-- Chat Messages with Inline Roles -->
<ul class="court-messages">
  {% assign slug = page.path | split: '/' | last | split: '.' | first %}
  {% assign messages = site.data.court_proceedings[slug] %}
  
  {% for msg in messages %}
    {% unless msg.username contains "[System]" %}
      {% assign uname = msg.username | remove: "<" | remove: ">" | split: " " %}
      {% if uname.size > 1 %}
        {% assign username_clean = uname[1] %}
      {% else %}
        {% assign username_clean = uname[0] %}
      {% endif %}

      {% comment %}Determine user role{% endcomment %}
      {% assign role_class = "" %}
      {% if username_clean == page.judge %}{% assign role_class = "role-judge" %}
      {% elsif page.jury contains username_clean %}{% assign role_class = "role-jury" %}
      {% elsif username_clean == page.plaintiff %}{% assign role_class = "role-plaintiff" %}
      {% elsif username_clean == page.plaintiff_attorney %}{% assign role_class = "role-plaintiff-attorney" %}
      {% elsif username_clean == page.defendant %}{% assign role_class = "role-defendant" %}
      {% elsif username_clean == page.defendant_attorney %}{% assign role_class = "role-defendant-attorney" %}
      {% elsif page.witnesses contains username_clean %}{% assign role_class = "role-witness" %}
      {% endif %}

      <li>
        <img src="https://mc-heads.net/avatar/{{ username_clean }}" alt="{{ username_clean }}'s avatar">
        <div>
          <strong>{{ username_clean }}</strong>
          {% if role_class %}
            <span class="role-label {{ role_class }}">{{ role_class | remove: "role-" | replace: "-", " " | capitalize }}</span>
          {% endif %}
          {% if msg.timestamp %}
            <span style="color: #555; font-size: 0.85em;">[{{ msg.timestamp | date: "%Y-%m-%d %H:%M" }}]</span>
          {% endif %}
          {% if msg.content %}
            <div style="margin-top: 0.2em;">{{ msg.content }}</div>
          {% endif %}
        </div>
      </li>
    {% endunless %}
  {% endfor %}
</ul>

<!-- Modal for media (unchanged) -->
<div id="mediaModal" class="modal">
  <span class="close-button" onclick="closeModal()">&times;</span>
  <div class="modal-content">
    <div id="media-content" class="media-container"></div>
    <div id="zoomControls" class="zoom-controls" style="display:none;">
      <button onclick="zoomOut()">-</button>
      <button onclick="zoomIn()">+</button>
    </div>
  </div>
</div>

<script>
let currentZoom = 1;
const zoomStep = 0.2;

function openModal(url, isImage, isVideo) {
  const modal = document.getElementById("mediaModal");
  const mediaContainer = document.getElementById("media-content");
  const zoomControls = document.getElementById("zoomControls");
  mediaContainer.innerHTML = "";
  currentZoom = 1;
  modal.style.display = "flex";
}

function closeModal() {
  document.getElementById("mediaModal").style.display = "none";
  document.getElementById("media-content").innerHTML = "";
}

function zoomIn() { currentZoom += zoomStep; applyZoom(); }
function zoomOut() { if (currentZoom > zoomStep) { currentZoom -= zoomStep; applyZoom(); } }
function applyZoom() {
  const media = document.querySelector("#media-content img, #media-content video");
  if (media) media.style.transform = `scale(${currentZoom})`;
}

window.onclick = function(event) {
  const modal = document.getElementById("mediaModal");
  if (event.target === modal) closeModal();
}
</script>
